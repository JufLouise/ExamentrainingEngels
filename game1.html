<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Engels Zinsanalyse Game</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #e0f2fe 0%, #f0f9ff 100%);
            color: #1f2937; /* donkergrijs */
        }
        
        /* Drag and Drop Styling */
        .chunk {
            transition: all 0.2s;
        }

        .question-draggable {
            transition: all 0.2s;
            cursor: grab;
            user-select: none;
        }

        .chunk.drop-target {
            background-color: #e0f7fa; /* lichtblauw */
            border-color: #00bcd4;
            box-shadow: 0 0 10px rgba(0, 188, 212, 0.5);
            transform: scale(1.02);
        }

        .chunk.correct {
            background-color: #e6ffed !important;
            border-color: #10b981 !important; /* emerald green */
            color: #065f46;
            animation: pop 0.3s ease-in-out;
        }

        .chunk.incorrect {
            background-color: #fee2e2 !important;
            border-color: #ef4444 !important; /* red */
            color: #991b1b;
            animation: shake 0.4s ease-in-out;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25%, 75% { transform: translateX(-5px); }
            50% { transform: translateX(5px); }
        }

        @keyframes pop {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
    </style>
</head>
<body class="min-h-screen p-4 md:p-8">

    <header class="bg-white shadow-xl p-4 md:p-6 rounded-xl mb-8 flex flex-col md:flex-row justify-between items-center gap-4">
        <div class="flex items-center gap-4">
            <div class="bg-blue-600 text-white p-3 rounded-xl text-3xl">
                <i class="fas fa-puzzle-piece"></i>
            </div>
            <div>
                <h1 class="font-bold text-2xl leading-tight text-slate-800">Zinsanalyse Game</h1>
                <p class="text-sm text-slate-500">Sleep de vraagwoorden naar het juiste zinsdeel</p>
            </div>
        </div>
        
        <div class="flex flex-row md:flex-col items-center md:items-end gap-4 md:gap-1 p-2 bg-slate-50 rounded-lg">
            <div class="flex items-center gap-4">
                <span class="text-sm text-slate-500">Level Voltooid</span>
                <span id="score" class="font-bold text-xl text-blue-600">0</span>
            </div>
            <div class="flex items-center gap-4">
                <span class="text-sm text-slate-500">Voortgang</span>
                <span id="percentage" class="font-bold text-xl text-green-600">0%</span>
            </div>
        </div>
    </header>

    <div class="bg-blue-50 border-l-4 border-blue-500 p-4 rounded-lg shadow-md mb-6">
        <p class="text-sm">
            <strong>Instructie:</strong> Analyseer de Engelse zin. Sleep de vraagwoorden van onderaf naar het bijbehorende zinsdeel. Levels A2 t/m B1 (Levels 1 t/m 10) zijn verplicht.
        </p>
    </div>

    <div class="flex gap-4 mb-6 justify-center">
        <button id="prev-level" class="bg-gray-300 hover:bg-gray-400 text-slate-800 font-bold py-2 px-4 rounded-lg transition-colors flex items-center gap-2">
            <i class="fas fa-arrow-left"></i> Vorige level
        </button>
        <button id="reset-btn" class="bg-yellow-400 hover:bg-yellow-500 text-slate-800 font-bold py-2 px-4 rounded-lg transition-colors flex items-center gap-2">
            <i class="fas fa-undo"></i> Reset level
        </button>
        <button id="next-level" class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-lg transition-colors flex items-center gap-2">
            Volgende level <i class="fas fa-arrow-right"></i>
        </button>
    </div>
    
    <div id="game-area" class="bg-white p-6 rounded-xl shadow-2xl">
        <div id="sentence-container" class="flex flex-wrap gap-4 mb-8 justify-center">
            </div>

        <h3 class="text-xl font-semibold mb-4 text-center border-t pt-4 border-slate-200">Beschikbare Vragen:</h3>
        <div id="questions-container" class="flex flex-wrap gap-3 justify-center bg-slate-100 p-4 rounded-lg shadow-inner">
            </div>
    </div>

    <div id="end-message" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white p-8 rounded-xl shadow-2xl text-center max-w-sm w-full animate-pop">
            <i class="fas fa-medal text-yellow-500 text-5xl mb-4"></i>
            <h4 class="text-2xl font-bold mb-3 text-slate-800">Gefeliciteerd!</h4>
            <p class="text-slate-600 mb-6">Je hebt alle levels voltooid en bent een echte Zinsanalyse Master.</p>
            <button onclick="location.reload()" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-5 rounded-lg">
                Opnieuw Spelen
            </button>
        </div>
    </div>


    <script>
        // Functie voor het rapporteren van de score aan het parent window
        function reportScore(currentScore) {
            window.parent.postMessage({
                type: 'UPDATE_SCORE',
                gameFile: window.location.pathname.split('/').pop(),
                score: currentScore
            }, '*');
        }

        const levels = [
            // Level 1 (A2)
            { text: "The curious young boy / wandered / through the old forest.", answers: {"Who?":0,"What?":1,"Where?":2,"When?":null}, level: "A2" },
            // Level 2 (A2)
            { text: "Yesterday morning / the busy chef / prepared breakfast / in the small kitchen.", answers: {"Who?":1,"What?":2,"Where?":3,"When?":0}, level: "A2" },
            // Level 3 (A2)
            { text: "The friendly teacher / explained the lesson / to the students.", answers: {"Who?":0,"What?":1,"To whom?":2,"Where?":null,"When?":null}, level: "A2" },
            // Level 4 (A2)
            { text: "During the long meeting / the project manager / presented a detailed report / to the board members.", answers: {"When?":0,"Who?":1,"What?":2,"To whom?":3,"Where?":null}, level: "B1" },
            // Level 5 (B1)
            { text: "The young volunteers / delivered food packages / to elderly residents / in the quiet neighborhood.", answers: {"Who?":0,"What?":1,"To whom?":2,"Where?":3,"When":null}, level: "B1" },
            // Level 6 (B1)
            { text: "Early this afternoon / the researcher / demonstrated the new device / in the science lab.", answers: {"When?":0,"Who?":1,"What?":2,"Where?":3}, level: "B1" },
            // Level 7 (B1)
            { text: "The journalist / asked several questions / to the mayor / after the conference.", answers: {"Who?":0,"What?":1,"To whom?":2,"When?":3,"Where?":null}, level: "B1" },
            // Level 8 (B1)
            { text: "Last Friday / the football coach / gave extra training / to the younger players / on the field.", answers: {"When?":0,"Who?":1,"What?":2,"To whom?":3,"Where?":4}, level: "B1" },
            // Level 9 (B1)
            { text: "The librarian / recommended a fascinating book / to the new student / in the reading room.", answers: {"Who?":0,"What?":1,"To whom?":2,"Where?":3,"When?":null}, level: "B1" },
            // Level 10 (B1) - Verplicht einde
            { text: "Later that evening / the group of friends / planned their holiday / at Emmaâ€™s house.", answers: {"When?":0,"Who?":1,"What?":2,"Where?":3}, level: "B1" },
            
            // Level 11 (B2) - Optioneel
            { text: "The biology teacher / showed a live experiment / to the curious class / during the lesson.", answers: {"Who?":0,"What?":1,"To whom?":2,"When?":3,"Where?":null}, level: "B2" },
            // Level 12 (B2) - Optioneel
            { text: "At the end of the week / the company director / announced important changes / to all employees.", answers: {"When?":0,"Who?":1,"What?":2,"To whom?":3,"Where?":null}, level: "B2" }
        ];

        const compulsoryEndIndex = 9; // Level 10 is index 9 (0-based)

        let currentLevel = 0;
        let score = 0;
        let isCompulsoryFinished = false;

        const sentenceContainer = document.getElementById("sentence-container");
        const questionsContainer = document.getElementById("questions-container");
        const endMessage = document.getElementById("end-message");

        function updateScoreboard() {
            document.getElementById("score").textContent = score;
            
            // Rapporteer de nieuwe score
            reportScore(score);

            const baseLevels = compulsoryEndIndex + 1;
            let percentageValue = 0;

            if (score <= baseLevels) {
                percentageValue = Math.round((score / baseLevels) * 100);
            } else {
                percentageValue = Math.round((score / levels.length) * 100);
            }
            
            document.getElementById("percentage").textContent = `${percentageValue}%`;
        }

        function loadLevel(levelIndex) {
            currentLevel = levelIndex;
            const level = levels[currentLevel];
            const paragraph = level.text;
            const answers = level.answers;
            
            const totalQuestions = Object.keys(answers).filter(q => answers[q] !== null).length;
            let correctCount = 0;

            sentenceContainer.innerHTML = "";
            questionsContainer.innerHTML = "";

            const chunks = paragraph.split("/").map(c => c.trim()).filter(c => c.length > 0);
            
            chunks.forEach((chunk, index) => {
                const div = document.createElement("div");
                div.className = "chunk bg-white p-4 rounded-xl border-2 border-slate-200 shadow-md min-w-[120px] text-center font-semibold text-base flex flex-col justify-center items-center relative";
                div.textContent = chunk;
                div.dataset.index = index;

                if (index === 0) {
                    const levelSpan = document.createElement('span');
                    levelSpan.className = 'absolute top-[-10px] left-2 bg-blue-500 text-white text-xs px-2 py-0.5 rounded-full shadow-sm';
                    levelSpan.textContent = `Level ${currentLevel + 1} (${level.level})`;
                    div.appendChild(levelSpan);
                }

                div.addEventListener("dragover", e => { e.preventDefault(); div.classList.add("drop-target"); });
                div.addEventListener("dragleave", () => div.classList.remove("drop-target"));
                div.addEventListener("drop", e => {
                    e.preventDefault();
                    div.classList.remove("drop-target");
                    const questionName = e.dataTransfer.getData("text/plain");
                    checkAnswer(questionName, index, div, answers);
                });

                sentenceContainer.appendChild(div);
            });

            ["Who?", "What?", "When?", "Where?", "To whom?"]
                .filter(q => q in answers)
                .forEach(q => {
                    if (answers[q] !== null && answers[q] !== undefined) {
                        const qDiv = document.createElement("div");
                        qDiv.className = "question-draggable bg-blue-600 text-white py-2 px-4 rounded-full font-medium shadow-md hover:bg-blue-700";
                        qDiv.textContent = q;
                        qDiv.draggable = true;
                        qDiv.addEventListener("dragstart", e => e.dataTransfer.setData("text/plain", q));
                        questionsContainer.appendChild(qDiv);
                    }
                });

            function checkAnswer(question, dropIndex, dropDiv, answers) {
                if (dropDiv.querySelector('.placed-question')) {
                    dropDiv.classList.add("incorrect");
                    setTimeout(() => dropDiv.classList.remove("incorrect"), 800);
                    return;
                }

                const correctIndex = answers[question];
                if (dropIndex == correctIndex) {
                    dropDiv.classList.add("correct");
                    
                    const qs = Array.from(document.querySelectorAll('.question-draggable'));
                    const matched = qs.find(el => el.textContent === question);
                    if (matched) {
                        matched.remove();

                        const placedQ = document.createElement('span');
                        placedQ.textContent = question;
                        placedQ.className = "placed-question block mt-2 text-xs font-bold px-2 py-0.5 rounded-full bg-green-500 text-white";
                        dropDiv.appendChild(placedQ);
                    }

                    correctCount++;

                    if (correctCount === totalQuestions) {
                        score++;
                        updateScoreboard();

                        if (currentLevel === compulsoryEndIndex && !isCompulsoryFinished) {
                            isCompulsoryFinished = true;
                            showCustomAlert('Hoofduitdaging voltooid!', 'Je hebt alle verplichte A2-B1 levels gehaald! Ga door naar de B2-levels voor de complete score, of sluit nu af.', true);
                        } else if (currentLevel < levels.length - 1) {
                            setTimeout(() => {
                                loadLevel(currentLevel + 1);
                            }, 800);
                        } else {
                            showCustomAlert('Gefeliciteerd!', 'Je hebt alle levels voltooid en bent een echte Zinsanalyse Master.', false);
                        }
                    }
                } else {
                    dropDiv.classList.add("incorrect");
                    setTimeout(() => dropDiv.classList.remove("incorrect"), 800);
                }
            }
        }

        function showCustomAlert(title, message, isOptionalPrompt) {
            endMessage.classList.remove('hidden');
            const content = endMessage.querySelector('div');
            
            content.innerHTML = `
                <i class="fas ${isOptionalPrompt ? 'fa-star text-yellow-500' : 'fa-medal text-blue-500'} text-5xl mb-4 animate-pop"></i>
                <h4 class="text-2xl font-bold mb-3 text-slate-800">${title}</h4>
                <p class="text-slate-600 mb-6">${message}</p>
                <div class="flex flex-col gap-2">
                    ${isOptionalPrompt ? 
                        `<button onclick="startOptionalNextLevel()" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-5 rounded-lg">
                            Ga naar B2 Uitdaging <i class="fas fa-arrow-right ml-2"></i>
                        </button>
                        <button onclick="hideCustomAlert();" class="bg-gray-400 hover:bg-gray-500 text-white font-bold py-2 px-5 rounded-lg">
                            Sluit af
                        </button>`
                        :
                        `<button onclick="location.reload()" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-5 rounded-lg">
                            Opnieuw Spelen
                        </button>`
                    }
                </div>
            `;
        }

        function hideCustomAlert() {
            endMessage.classList.add('hidden');
        }

        function startOptionalNextLevel() {
            hideCustomAlert();
            loadLevel(currentLevel + 1);
        }

        document.getElementById('prev-level').addEventListener('click', () => {
            if (currentLevel > 0) {
                loadLevel(currentLevel - 1);
            }
        });

        document.getElementById('next-level').addEventListener('click', () => {
            if (currentLevel < levels.length - 1) {
                if (currentLevel === compulsoryEndIndex && !isCompulsoryFinished) {
                    showCustomAlert('Hoofduitdaging voltooid!', 'Je hebt alle verplichte A2-B1 levels gehaald! Ga door naar de B2-levels voor de complete score, of sluit nu af.', true);
                } else {
                    loadLevel(currentLevel + 1);
                }
            }
        });

        document.getElementById('reset-btn').addEventListener('click', () => loadLevel(currentLevel));

        // Initialisatie
        updateScoreboard();
        loadLevel(currentLevel);
    </script>
</body>
</html>
